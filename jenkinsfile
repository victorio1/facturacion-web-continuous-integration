def IP_SERVIDOR = '192.168.1.11'
def URL_REPOSITORIO_GIT = "https://github.com/victorio1/facturacion-web-continuous-integration.git"

pipeline{
    agent any

    tools{
        maven 'Maven 3.6.3'
        jdk 'jdk8'
    }

    stages{

        stage('Initialize'){

            steps{

                sh '''
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                '''

            }

        }

        stage('Download Fonts'){

            steps{
                echo 'Descargando fuentes....'
                git credentialsId: 'git-devops', url: "${URL_REPOSITORIO_GIT}"
            }

        }

        stage('Building'){

            steps{
                echo 'Building....'
                sh 'mvn -f pom.xml clean compile'
            }

        }

        stage('Unit Tests'){

            steps{
                echo 'Execute Unit Tests'
                sh 'mvn -f pom.xml test'
                junit '**/target/surefire-reports/*.xml'
            }

        }

        stage('Integration Tests'){

            steps{

                echo 'Execute Integration Tests'
                sh 'mvn -f pom.xml verify -DskipUTs=true -Dspring.profiles.active=test'
                junit '**/target/failsafe-reports/*.xml'

            }

        }

        stage('Analysis SonarQube'){
            steps{
                echo 'Executing Analysis code static'
                withSonarQubeEnv('sonar-devops'){
                    sh "mvn -f pom.xml sonar:sonar -Dsonar.host.url=http://${IP_SERVIDOR}:9000"
                }
            }
        }

        stage('Build'){
            steps{
                echo 'Generando build...'
                sh 'mvn -f pom.xml package -DskipTests=true'

            }


        }

    }

}